{"map":"{\"version\":3,\"sources\":[\"webpack/bootstrap\",\"/Users/didi/Downloads/test-xevent/src/XPStream.js\",\"/Users/didi/Downloads/test-xevent/src/XPTracker.js\",\"/Users/didi/Downloads/test-xevent/src/index.js\",\"/Users/didi/Downloads/test-xevent/src/XPEventManager.js\",\"/Users/didi/Downloads/test-xevent/src/XPRegisterTrackers.js\",\"/Users/didi/Downloads/test-xevent/src/XPStashTracker.js\"],\"names\":[\"installedModules\",\"__webpack_require__\",\"moduleId\",\"exports\",\"module\",\"i\",\"l\",\"modules\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"[object Object]\",\"this\",\"streams\",\"currentDimension\",\"event\",\"getId\",\"indexOf\",\"systemTrackers\",\"tracker\",\"receiveEvent\",\"bufferEvents\",\"Array\",\"currentTrackers\",\"reSendEvent\",\"console\",\"log\",\"push\",\"bufferEvent\",\"trackers\",\"dimension\",\"trackerGroup\",\"reset\",\"index\",\"descriptions\",\"completion\",\"breaker\",\"resendEventCb\",\"descriptor\",\"timestamp\",\"Date\",\"parse\",\"self\",\"length\",\"onResendEvent\",\"initStream\",\"initTrackers\",\"stream\",\"ostype\",\"sendEvent\",\"objs\",\"eval\",\"JSON\",\"innerEvent\",\"Event\",\"xpEventId\",\"time\",\"attrsMap\",\"eventAttrsMap\",\"init\",\"osType\",\"registerSystemTracker\",\"newStream\",\"EventTracker\",\"StashEventTracker\",\"isTest\",\"registerTrackers\",\"xpanel_sw_tracker\",\"addDescriptor\",\"fulfill\",\"addCompletion\",\"triggerReport\",\"stringify\",\"pullup_tracker\",\"getEventAttr\",\"addResendEventCb\",\"setTime\",\"setId\",\"xpanel_sw_time_tracker\",\"putStashEvent\",\"duration\",\"getTime\",\"getStashEvent\",\"putAttr\",\"xpanel_half_reveal_sw_tracker\",\"xpanel_card_ck_tracker\",\"xpanel_button_ck_tracker\",\"jsonData\",\"xpEventManager\",\"registerTracker\",\"getDimension\",\"unregisterTracker\",\"dimensionChangeTracker\",\"pushVCTracker\",\"changeDimensionAndResetTrackers\",\"super\",\"stashEventMap\",\"alias\"],\"mappings\":\"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\",\"sourcesContent\":[\" \\t// The module cache\\n \\tvar installedModules = {};\\n\\n \\t// The require function\\n \\tfunction __webpack_require__(moduleId) {\\n\\n \\t\\t// Check if module is in cache\\n \\t\\tif(installedModules[moduleId]) {\\n \\t\\t\\treturn installedModules[moduleId].exports;\\n \\t\\t}\\n \\t\\t// Create a new module (and put it into the cache)\\n \\t\\tvar module = installedModules[moduleId] = {\\n \\t\\t\\ti: moduleId,\\n \\t\\t\\tl: false,\\n \\t\\t\\texports: {}\\n \\t\\t};\\n\\n \\t\\t// Execute the module function\\n \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n\\n \\t\\t// Flag the module as loaded\\n \\t\\tmodule.l = true;\\n\\n \\t\\t// Return the exports of the module\\n \\t\\treturn module.exports;\\n \\t}\\n\\n\\n \\t// expose the modules object (__webpack_modules__)\\n \\t__webpack_require__.m = modules;\\n\\n \\t// expose the module cache\\n \\t__webpack_require__.c = installedModules;\\n\\n \\t// define getter function for harmony exports\\n \\t__webpack_require__.d = function(exports, name, getter) {\\n \\t\\tif(!__webpack_require__.o(exports, name)) {\\n \\t\\t\\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\\n \\t\\t}\\n \\t};\\n\\n \\t// define __esModule on exports\\n \\t__webpack_require__.r = function(exports) {\\n \\t\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n \\t\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n \\t\\t}\\n \\t\\tObject.defineProperty(exports, '__esModule', { value: true });\\n \\t};\\n\\n \\t// create a fake namespace object\\n \\t// mode & 1: value is a module id, require it\\n \\t// mode & 2: merge all properties of value into the ns\\n \\t// mode & 4: return value when already ns object\\n \\t// mode & 8|1: behave like require\\n \\t__webpack_require__.t = function(value, mode) {\\n \\t\\tif(mode & 1) value = __webpack_require__(value);\\n \\t\\tif(mode & 8) return value;\\n \\t\\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\\n \\t\\tvar ns = Object.create(null);\\n \\t\\t__webpack_require__.r(ns);\\n \\t\\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\\n \\t\\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\\n \\t\\treturn ns;\\n \\t};\\n\\n \\t// getDefaultExport function for compatibility with non-harmony modules\\n \\t__webpack_require__.n = function(module) {\\n \\t\\tvar getter = module && module.__esModule ?\\n \\t\\t\\tfunction getDefault() { return module['default']; } :\\n \\t\\t\\tfunction getModuleExports() { return module; };\\n \\t\\t__webpack_require__.d(getter, 'a', getter);\\n \\t\\treturn getter;\\n \\t};\\n\\n \\t// Object.prototype.hasOwnProperty.call\\n \\t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\\n\\n \\t// __webpack_public_path__\\n \\t__webpack_require__.p = \\\"\\\";\\n\\n\\n \\t// Load entry module and return exports\\n \\treturn __webpack_require__(__webpack_require__.s = 2);\\n\",\"class EventStream {\\n    constructor() {\\n        // K 维度  V 容器(K     V   )\\n        this.streams = [];\\n        // 记录当前维度\\n        this.currentDimension = null;\\n    }\\n\\n    receiveEvent(event) {\\n        if (event.getId().indexOf(\\\"XEventSystem\\\") == 0) {\\n            let stream = this.streams[\\\"XEventSystem\\\"];\\n            let systemTrackers = stream[\\\"trackers\\\"];\\n            for (let tracker of systemTrackers) {\\n                tracker.receiveEvent(event);\\n            }\\n            return;\\n        }\\n\\n        //tracker回传的事件\\n        var bufferEvents = new Array()\\n        let currentStream = this.streams[this.currentDimension];\\n        let currentTrackers = currentStream[\\\"trackers\\\"];\\n        for (let tracker of currentTrackers) {\\n            let reSendEvent = tracker.receiveEvent(event);\\n            if(reSendEvent){\\n                console.log(\\\"buffer event : \\\" + reSendEvent.getId());\\n                bufferEvents.push(reSendEvent);\\n            }\\n        }\\n\\n        for (let bufferEvent of bufferEvents)\\n        {\\n            this.receiveEvent(bufferEvent);\\n        }\\n    }\\n    \\n    registerTrackers(trackers, dimension) { \\n        this.currentDimension = dimension;\\n        // 存放当前维度所需要的信息及 trackers\\n        var trackerGroup = [];\\n        trackerGroup[\\\"trackers\\\"] = trackers;\\n        this.streams[dimension] = trackerGroup;\\n    }\\n    \\n    unregisterTracker(dimension){\\n        this.currentDimension = null;\\n        if (this.streams[dimension]) {\\n            delete this.streams[dimension];\\n        }\\n    }\\n\\n    changeDimensionAndResetTrackers(dimension) {\\n        this.currentDimension = dimension;\\n        let currentStream = this.streams[dimension];\\n        let currentTrackers = currentStream[\\\"trackers\\\"];\\n        for (let tracker of currentTrackers) {\\n            tracker.reset();\\n        }\\n    }\\n\\n}\\n\\nmodule.exports = EventStream;\\n\",\"class EventTracker {\\n    constructor(name) {\\n        this.name = name;\\n        this.index = 0;\\n        this.descriptions = [];\\n        this.completion = null;\\n        this.breaker = null;\\n        this.resendEventCb = null;\\n    }\\n    addDescriptor(descriptor) {\\n        this.descriptions.push(descriptor);\\n        return this;\\n    }\\n    addBreaker(breaker) {\\n        this.breaker = breaker;\\n        return this;\\n    }\\n    addCompletion(completion) {\\n        this.completion = completion;\\n        return this;\\n    }\\n    addResendEventCb(resendEventCb){\\n        this.resendEventCb = resendEventCb;\\n        return this;\\n    }\\n\\n    reset() {\\n        this.index = 0;\\n    }\\n\\n    onResendEvent(event){\\n        //构建新事件的时间戳\\n        var timestamp = Date.parse(new Date());\\n        if(this.resendEventCb){\\n            let reSentEvent = this.resendEventCb(event, timestamp);\\n            return reSentEvent;\\n        }\\n        return null;\\n    }\\n\\n    receiveEvent(event) {\\n        let descriptor = this.descriptions[this.index];\\n        if(!descriptor){\\n            return null;\\n        }\\n        var self = this;\\n        let fulfill = function(event) {\\n            self.index++;\\n        };\\n        let breaker = (event) => {\\n            self.index = 0;\\n        };\\n\\n//        console.log(descriptor);\\n        descriptor(event, fulfill, breaker);\\n        \\n        if (this.index >= this.descriptions.length) {\\n            if (this.completion) {\\n                this.completion(event);\\n            }\\n            this.index = 0;\\n            //满足条件之后看有没有需要回传的事件\\n            let resendEvent = this.onResendEvent(event);\\n            return resendEvent;\\n        }\\n        return null;\\n    }\\n}\\n\\nmodule.exports = EventTracker;\\n\",\"require('./XPEventManager.js');\",\"var initStream = require('./XPStream');\\nvar initTrackers = require('./XPRegisterTrackers');\\n\\nvar stream = new initStream();\\nvar ostype = 1;\\ninitTrackers.registerSystemTracker(stream);\\nfunction sendEvent(event) {\\n    var objs;\\n    if(ostype == 0){\\n        objs= eval(event);\\n    }else{\\n        objs= JSON.parse(event);\\n    }\\n    var innerEvent = new Event(objs.dimension, objs.xpEventId, objs.time, objs.attrsMap, objs.eventAttrsMap);\\n    stream.receiveEvent(innerEvent)\\n}\\n\\n//区分os\\nfunction init(osType){\\n    ostype = osType;\\n}\\n\\nmodule.exports = {\\n    newStream: stream\\n};\\n\\n\\n\\n\\n\\n\",\"var EventTracker = require('./XPTracker.js');\\nvar stream = require('./XPStream');\\nvar StashEventTracker = require('./XPStashTracker');\\n\\nvar isTest = 1;\\n\\n//根据 dimension 注册一组 tracker\\nfunction registerTrackers(stream, dimension){\\n    var trackers = [];\\n\\n     //xpanel曝光\\n    var xpanel_sw_tracker = new EventTracker(\\\"xpanel_sw\\\");\\n    xpanel_sw_tracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"xpanel_sw\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n        var jsonData = JSON.stringify(event);\\n        triggerReport(\\\"xpanel_sw\\\", jsonData);\\n    });\\n    trackers.push(xpanel_sw_tracker);\\n\\n    //拉起\\n    var pullup_tracker = new EventTracker(\\\"xpanel_pull_up\\\");\\n    pullup_tracker.addDescriptor((event, fulfill, breaker)=>{\\n        if ((event.getId() == \\\"xpanel_init\\\" || event.getId() == \\\"xpanel_scroll\\\") && event.getEventAttr(\\\"scroll_distance\\\") == 0) {\\n            fulfill(event);\\n        }\\n    }).addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"xpanel_scroll\\\" && event.getEventAttr(\\\"scroll_distance\\\") > 0) {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n        var jsonData = JSON.stringify(event);\\n        triggerReport(\\\"xpanel_pull_up\\\", jsonData);\\n    }).addResendEventCb((event, timestamp)=>{\\n            event.setTime(timestamp);\\n            event.setId(\\\"xpanel_pull_up\\\");\\n            return event;\\n        }\\n    );\\n    trackers.push(pullup_tracker);\\n\\n    //曝光时长\\n    var xpanel_sw_time_tracker = new StashEventTracker(\\\"xpanel_sw_time\\\");\\n    xpanel_sw_time_tracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"xpanel_keep\\\") {\\n            fulfill(event);\\n            xpanel_sw_time_tracker.putStashEvent(\\\"A\\\", event);\\n        }\\n    }).addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"xpanel_release\\\") {\\n            let duration = event.getTime() - xpanel_sw_time_tracker.getStashEvent(\\\"A\\\").getTime();\\n            event.putAttr(\\\"time\\\", duration);\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n        var jsonData = JSON.stringify(event);\\n        triggerReport(\\\"xpanel_sw_time\\\", jsonData);\\n    }).addResendEventCb((event, timestamp)=>{\\n          event.setTime(timestamp);\\n          event.setId(\\\"xpanel_sw_time\\\");\\n          return event;\\n      }\\n    );\\n    trackers.push(xpanel_sw_time_tracker);\\n\\n    var xpanel_half_reveal_sw_tracker = new EventTracker(\\\"xpanel_half_reveal_sw\\\");\\n    xpanel_half_reveal_sw_tracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"xpanel_half_sw\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n        var jsonData = JSON.stringify(event);\\n        triggerReport(\\\"xpanel_sw\\\", jsonData);\\n    });\\n    trackers.push(xpanel_half_reveal_sw_tracker);\\n\\n    // XPanel 卡片点击\\n    var xpanel_card_ck_tracker = new EventTracker(\\\"xpanel_card_ck\\\");\\n    xpanel_card_ck_tracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"card_ck\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n         var jsonData = JSON.stringify(event);\\n         triggerReport(\\\"xpanel_card_ck\\\", jsonData);\\n     });\\n    trackers.push(xpanel_card_ck_tracker);\\n    \\n    // XPanel 卡片按钮点击\\n    var xpanel_button_ck_tracker = new EventTracker(\\\"xpanel_button_ck\\\");\\n    xpanel_button_ck_tracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"btn_ck\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n        var jsonData = JSON.stringify(event);\\n        triggerReport(\\\"xpanel_button_ck\\\", jsonData);\\n    });\\n    trackers.push(xpanel_button_ck_tracker);\\n\\n    // 注册整组 trackers\\n    stream.registerTrackers(trackers, dimension);\\n}\\n\\nfunction registerSystemTracker(stream){\\n    var trackers = [];\\n    // VC init\\n    //var registerTracker  = new EventTracker(\\\"xevent_trackers_register\\\");\\n    var registerTracker = new EventTracker(\\\"xevent_trackers_register\\\");\\n    registerTracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"XEventSystem_VC_init\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n       // 注册 trackers\\n       registerTrackers(stream, event.getDimension())\\n    });\\n    trackers.push(registerTracker);\\n\\n    // VC dealloc\\n    var unregisterTracker  = new EventTracker(\\\"xevent_trackers_dealloc\\\");\\n    unregisterTracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"XEventSystem_VC_dealloc\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n       // 销毁 trackers\\n       stream.unregisterTracker(event.getDimension())\\n    });\\n    trackers.push(unregisterTracker);\\n\\n    // 同一个 VC ，场景(dimension)切换\\n    var dimensionChangeTracker  = new EventTracker(\\\"xevent_dimension_change\\\");\\n    dimensionChangeTracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"XEventSystem_dimension_change\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n       registerTrackers(stream, event.getDimension())\\n    });\\n    trackers.push(dimensionChangeTracker);\\n\\n    // 切换业务线至未被销毁的 VC\\n    var pushVCTracker  = new EventTracker(\\\"xevent_push_VC\\\");\\n    pushVCTracker.addDescriptor((event, fulfill, breaker)=>{\\n        if (event.getId() == \\\"XEventSystem_push_VC\\\") {\\n            fulfill(event);\\n        }\\n    }).addCompletion((event)=>{\\n       stream.changeDimensionAndResetTrackers(event.getDimension());\\n    });\\n    trackers.push(pushVCTracker);\\n\\n    // 注册 system trackers\\n    stream.registerTrackers(trackers, \\\"XEventSystem\\\");\\n}\\n\\nmodule.exports = {\\n    registerTrackers:registerTrackers,\\n    registerSystemTracker:registerSystemTracker,\\n};\\n\\nfunction triggerReport(log, jsonData) {\\n    if (isTest == 1) {\\n        console.log(log);\\n    } else {\\n        xpEventManager.triggerReport(log, jsonData);\\n    }\\n}\",\"var EventTracker = require('./XPTracker.js');\\nclass StashEventTracker extends EventTracker{\\n    constructor(name) {\\n        super(name);\\n        this.stashEventMap = [];\\n    }\\n\\n    putStashEvent(alias, event){\\n        this.stashEventMap[alias] = event;\\n    }\\n\\n    getStashEvent(alias){\\n        return this.stashEventMap[alias];\\n    }\\n\\n    receiveEvent(event) {\\n        let descriptor = this.descriptions[this.index];\\n        if(!descriptor){\\n            return null;\\n        }\\n        var self = this;\\n        let fulfill = function(event) {\\n            self.index++;\\n        };\\n        let breaker = (event) => {\\n            self.index = 0;\\n        };\\n\\n        descriptor(event, fulfill, breaker);\\n        \\n        if (this.index >= this.descriptions.length) {\\n            if (this.completion) {\\n                this.completion(event);\\n            }\\n            this.index = 0;\\n\\n            //满足条件之后看有没有需要回传的事件\\n            let resendEvent = this.onResendEvent(event);\\n//                console.log(resendEvent.getId());\\n            return resendEvent;\\n        }\\n        return null;\\n    }\\n}\\n\\nmodule.exports = StashEventTracker;\\n\"]}","code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=2)}([function(e,t){e.exports=class{constructor(){this.streams=[],this.currentDimension=null}receiveEvent(e){if(0==e.getId().indexOf(\"XEventSystem\")){let t=this.streams.XEventSystem.trackers;for(let n of t)n.receiveEvent(e);return}var t=new Array;let n=this.streams[this.currentDimension].trackers;for(let r of n){let n=r.receiveEvent(e);n&&(console.log(\"buffer event : \"+n.getId()),t.push(n))}for(let e of t)this.receiveEvent(e)}registerTrackers(e,t){this.currentDimension=t;var n=[];n.trackers=e,this.streams[t]=n}unregisterTracker(e){this.currentDimension=null,this.streams[e]&&delete this.streams[e]}changeDimensionAndResetTrackers(e){this.currentDimension=e;let t=this.streams[e].trackers;for(let e of t)e.reset()}}},function(e,t){e.exports=class{constructor(e){this.name=e,this.index=0,this.descriptions=[],this.completion=null,this.breaker=null,this.resendEventCb=null}addDescriptor(e){return this.descriptions.push(e),this}addBreaker(e){return this.breaker=e,this}addCompletion(e){return this.completion=e,this}addResendEventCb(e){return this.resendEventCb=e,this}reset(){this.index=0}onResendEvent(e){var t=Date.parse(new Date);return this.resendEventCb?this.resendEventCb(e,t):null}receiveEvent(e){let t=this.descriptions[this.index];if(!t)return null;var n=this;return t(e,function(e){n.index++},e=>{n.index=0}),this.index>=this.descriptions.length?(this.completion&&this.completion(e),this.index=0,this.onResendEvent(e)):null}}},function(e,t,n){n(3)},function(module,exports,__webpack_require__){var initStream=__webpack_require__(0),initTrackers=__webpack_require__(4),stream=new initStream,ostype=1;function sendEvent(event){var objs;objs=0==ostype?eval(event):JSON.parse(event);var innerEvent=new Event(objs.dimension,objs.xpEventId,objs.time,objs.attrsMap,objs.eventAttrsMap);stream.receiveEvent(innerEvent)}function init(e){ostype=e}initTrackers.registerSystemTracker(stream),module.exports={newStream:stream}},function(e,t,n){var r=n(1),s=(n(0),n(5)),i=1;function o(e,t){var n=[],i=new r(\"xpanel_sw\");i.addDescriptor((e,t,n)=>{\"xpanel_sw\"==e.getId()&&t(e)}).addCompletion(e=>{a(\"xpanel_sw\",JSON.stringify(e))}),n.push(i);var o=new r(\"xpanel_pull_up\");o.addDescriptor((e,t,n)=>{\"xpanel_init\"!=e.getId()&&\"xpanel_scroll\"!=e.getId()||0!=e.getEventAttr(\"scroll_distance\")||t(e)}).addDescriptor((e,t,n)=>{\"xpanel_scroll\"==e.getId()&&e.getEventAttr(\"scroll_distance\")>0&&t(e)}).addCompletion(e=>{a(\"xpanel_pull_up\",JSON.stringify(e))}).addResendEventCb((e,t)=>(e.setTime(t),e.setId(\"xpanel_pull_up\"),e)),n.push(o);var d=new s(\"xpanel_sw_time\");d.addDescriptor((e,t,n)=>{\"xpanel_keep\"==e.getId()&&(t(e),d.putStashEvent(\"A\",e))}).addDescriptor((e,t,n)=>{if(\"xpanel_release\"==e.getId()){let n=e.getTime()-d.getStashEvent(\"A\").getTime();e.putAttr(\"time\",n),t(e)}}).addCompletion(e=>{a(\"xpanel_sw_time\",JSON.stringify(e))}).addResendEventCb((e,t)=>(e.setTime(t),e.setId(\"xpanel_sw_time\"),e)),n.push(d);var l=new r(\"xpanel_half_reveal_sw\");l.addDescriptor((e,t,n)=>{\"xpanel_half_sw\"==e.getId()&&t(e)}).addCompletion(e=>{a(\"xpanel_sw\",JSON.stringify(e))}),n.push(l);var c=new r(\"xpanel_card_ck\");c.addDescriptor((e,t,n)=>{\"card_ck\"==e.getId()&&t(e)}).addCompletion(e=>{a(\"xpanel_card_ck\",JSON.stringify(e))}),n.push(c);var p=new r(\"xpanel_button_ck\");p.addDescriptor((e,t,n)=>{\"btn_ck\"==e.getId()&&t(e)}).addCompletion(e=>{a(\"xpanel_button_ck\",JSON.stringify(e))}),n.push(p),e.registerTrackers(n,t)}function a(e,t){1==i?console.log(e):xpEventManager.triggerReport(e,t)}e.exports={registerTrackers:o,registerSystemTracker:function(e){var t=[],n=new r(\"xevent_trackers_register\");n.addDescriptor((e,t,n)=>{\"XEventSystem_VC_init\"==e.getId()&&t(e)}).addCompletion(t=>{o(e,t.getDimension())}),t.push(n);var s=new r(\"xevent_trackers_dealloc\");s.addDescriptor((e,t,n)=>{\"XEventSystem_VC_dealloc\"==e.getId()&&t(e)}).addCompletion(t=>{e.unregisterTracker(t.getDimension())}),t.push(s);var i=new r(\"xevent_dimension_change\");i.addDescriptor((e,t,n)=>{\"XEventSystem_dimension_change\"==e.getId()&&t(e)}).addCompletion(t=>{o(e,t.getDimension())}),t.push(i);var a=new r(\"xevent_push_VC\");a.addDescriptor((e,t,n)=>{\"XEventSystem_push_VC\"==e.getId()&&t(e)}).addCompletion(t=>{e.changeDimensionAndResetTrackers(t.getDimension())}),t.push(a),e.registerTrackers(t,\"XEventSystem\")}}},function(e,t,n){var r=n(1);e.exports=class extends r{constructor(e){super(e),this.stashEventMap=[]}putStashEvent(e,t){this.stashEventMap[e]=t}getStashEvent(e){return this.stashEventMap[e]}receiveEvent(e){let t=this.descriptions[this.index];if(!t)return null;var n=this;return t(e,function(e){n.index++},e=>{n.index=0}),this.index>=this.descriptions.length?(this.completion&&this.completion(e),this.index=0,this.onResendEvent(e)):null}}}]);","extractedComments":[]}